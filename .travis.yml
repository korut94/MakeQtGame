sudo: required

services:
  - docker

before_install:
  # Install local-persist. See: https://github.com/CWSpear/local-persist
  - curl -fsSL https://raw.githubusercontent.com/CWSpear/local-persist/master/scripts/install.sh | sudo bash -s -- --upstart
  # Require from the Docker's services. The volume 'source-data' is declared 'external' in the Docker Compose configuration
  # to decouple the source code's location with that of the Docker Compose file. Since the physical paths are resolved in
  # the building configuration context itself (like this for Travis.CI) and not in the Docker file, it can be moved in a
  # different context.
  - docker volume create -d local-persist -o mountpoint=${TRAVIS_BUILD_DIR} --name=source-data
  - docker-compose -f docker/docker-compose.yml build
  - docker-compose -f docker/docker-compose.yml -f docker/docker-compose.linux.yml build

script:
  - docker-compose -f docker/docker-compose.yml -f docker/docker-compose.linux.yml run test
  - docker-compose -f docker/docker-compose.yml run docs

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  local_dir: docs
  on:
    branch: dev
    